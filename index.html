<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ducale æœå¡å‹’ - ç¾©å¼é¤é…’é¤¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS å€åŸŸ --- */
        :root {
            --primary-color: #d35400;
            --bg-color: #fdfbf7;
            --text-color: #333;
            --sidebar-width: 250px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Noto Serif TC", "Microsoft JhengHei", serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 80px; 
            overflow-x: hidden;
        }

        /* --- UI å…ƒä»¶ --- */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 2000;
            display: flex; align-items: center; padding: 0 20px; justify-content: space-between;
        }
        .hamburger-btn { font-size: 1.5rem; background: none; border: none; cursor: pointer; color: #333; padding: 5px; }
        .brand-name { font-size: 1.3rem; font-weight: bold; margin-left: 15px; color: var(--text-color); letter-spacing: 1px; }
        
        .table-badge {
            background: #95a5a6; /* é è¨­ç°è‰² */
            color: white; padding: 5px 15px;
            border-radius: 20px; font-weight: bold; font-size: 0.9rem;
        }
        .table-badge.active { background: var(--primary-color); }

        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2001; display: none; opacity: 0; transition: opacity 0.3s;
        }
        .sidebar-overlay.active { display: block; opacity: 1; }

        .sidebar {
            position: fixed; top: 0; left: -250px; width: var(--sidebar-width); height: 100%;
            background: white; z-index: 2002; transition: left 0.3s ease-out;
            padding-top: 60px; box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .sidebar.active { left: 0; }
        .sidebar-link { display: block; padding: 15px 25px; text-decoration: none; color: #333; border-bottom: 1px solid #eee; transition: 0.2s; }
        .sidebar-link:hover { background: #f9f9f9; color: var(--primary-color); }
        .sidebar-close { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; background: none; border: none; cursor: pointer; }

        .page-section { display: none; padding-top: 60px; min-height: 100vh; animation: fadeIn 0.5s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- é¦–é  --- */
        .hero-section {
            background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('images/main-big.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            height: 85vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; color: white;
        }
        .hero-title { font-size: 3rem; margin-bottom: 10px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        
        .status-bar {
            background: white; padding: 30px 20px; text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin: -50px 20px 20px 20px;
            border-radius: 10px; position: relative; z-index: 10;
        }
        .status-indicator { font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; }
        .status-time { color: #666; font-size: 0.9rem; }

        /* --- é»é¤é  --- */
        .category-scroll {
            display: flex; overflow-x: auto; white-space: nowrap; padding: 15px 10px;
            position: sticky; top: 60px; background: var(--bg-color); z-index: 900;
        }
        .cat-btn {
            background: white; border: 1px solid #ddd; color: #666;
            padding: 8px 18px; margin: 0 5px; border-radius: 20px; cursor: pointer; flex-shrink: 0; transition: 0.2s;
        }
        .cat-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        /* --- é†¬æ±éæ¿¾æŒ‰éˆ•å€ --- */
        .sauce-scroll {
            display: none; /* é è¨­éš±è— */
            overflow-x: auto; white-space: nowrap; padding: 10px 15px;
            background: #fdfbf7; z-index: 899;
            border-bottom: 1px solid #eee;
        }
        .sauce-btn {
            background: transparent; border: 1px solid #ccc; color: #666;
            padding: 5px 15px; margin-right: 8px; border-radius: 15px; 
            cursor: pointer; font-size: 0.9rem; transition: 0.2s;
            flex-shrink: 0;
        }
        .sauce-btn.active {
            background: #e67e22; color: white; border-color: #e67e22;
        }
        .select-sauce-msg {
            text-align: center; padding: 40px; color: #999; font-size: 1.1rem;
        }

        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 20px; padding: 0 15px; max-width: 800px; margin: 0 auto; }
        @media (min-width: 600px) { .menu-grid { grid-template-columns: repeat(2, 1fr); } }

        .menu-item {
            background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02); transition: 0.2s;
        }
        .menu-item.disabled { cursor: default; opacity: 0.8; }
        .item-price { font-weight: bold; color: var(--primary-color); font-size: 1.1rem; }

        /* --- å…¶ä»– --- */
        .info-card { background: white; max-width: 600px; margin: 20px auto; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .info-row { display: flex; margin-bottom: 15px; align-items: flex-start; }
        .info-icon { margin-right: 10px; font-size: 1.2rem; }
        
        .gallery-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; max-width: 800px; margin: 0 auto; }
        .gallery-item { background: white; border-radius: 8px; overflow: hidden; cursor: pointer; position: relative; }
        .gallery-thumb { width: 100%; padding-top: 100%; background-size: cover; background-position: center; background-color: #eee; }
        .gallery-name { padding: 10px; text-align: center; font-size: 0.9rem; font-weight: bold; }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 3000;
            display: none; align-items: center; justify-content: center;
        }
        .modal-overlay.open { display: flex; }
        
        .modal-content {
            background: white; width: 90%; max-width: 400px; padding: 25px;
            border-radius: 15px; position: relative; animation: popUp 0.3s;
        }
        @keyframes popUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .img-modal-content { padding: 0; overflow: hidden; background: transparent; max-width: 500px; }
        .img-display { width: 100%; display: block; border-radius: 10px; }
        .img-modal-close { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; }

        .success-icon { font-size: 4rem; color: #2ecc71; text-align: center; display: block; margin-bottom: 20px; }
        .order-summary { background: #f9f9f9; padding: 15px; border-radius: 8px; font-size: 0.9rem; margin-bottom: 20px; max-height: 200px; overflow-y: auto; }

        .cart-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: #2c3e50; color: white;
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            transform: translateY(100%); transition: transform 0.3s; z-index: 1000;
        }
        .cart-bar.active { transform: translateY(0); }
        .cart-drawer { position: fixed; bottom: 70px; left: 0; width: 100%; background: white; max-height: 0; overflow-y: auto; transition: max-height 0.3s; z-index: 999; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        .cart-drawer.open { max-height: 60vh; border-top: 4px solid var(--primary-color); }
        .cart-list-item { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }

        .radio-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; margin: 10px 0 20px 0;}
        .radio-btn-label { text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-size: 0.9rem; }
        input[type="radio"]:checked + .radio-btn-label { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        input[type="radio"]:disabled + .radio-btn-label { background: #f0f0f0; color: #ccc; cursor: not-allowed; }
        input[type="radio"] { display: none; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div style="display:flex; align-items:center;">
            <button class="hamburger-btn" onclick="toggleSidebar()">â˜°</button>
            <div class="brand-name">Ducale</div>
        </div>
        <div id="table-display" class="table-badge">ç´”ç€è¦½æ¨¡å¼</div>
    </nav>

    <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div id="sidebar" class="sidebar">
        <button class="sidebar-close" onclick="toggleSidebar()">âœ•</button>
        <div style="padding: 30px 20px 20px; color: var(--primary-color); font-weight: bold; font-size: 1.2rem;">MENU</div>
        <a href="#" class="sidebar-link" onclick="switchPage('home')">ğŸ  å›åˆ°é¦–é </a>
        <a href="#" class="sidebar-link" onclick="switchPage('info')">â„¹ï¸ åº—å®¶è³‡è¨Š</a>
        <a href="#" class="sidebar-link" onclick="switchPage('gallery')">ğŸ“· å•†å“ç°¡ä»‹</a>
        <a href="#" class="sidebar-link" onclick="switchPage('menu')">ğŸ ç·šä¸Šé»é¤</a>
    </div>

    <section id="page-home" class="page-section active" style="padding-top: 0;">
        <div class="hero-section">
            <h1 class="hero-title">Ducale</h1>
            <p style="font-size: 1.2rem; margin-bottom: 20px;">ç”¨å¿ƒç†¬ç…®çš„ç¾©å¼éˆé­‚</p>
            <div id="home-table-info" style="margin-bottom: 20px; background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 15px; font-size: 0.9rem;"></div>
            <div id="home-cta-btn" style="padding: 12px 35px; background: var(--primary-color); border-radius: 30px; cursor: pointer; font-weight: bold;" onclick="switchPage('menu')">æŸ¥çœ‹èœå–®</div>
        </div>
        <div class="status-bar">
            <div id="home-status-icon" class="status-indicator">æª¢æŸ¥ä¸­...</div>
            <div id="home-status-text" class="status-time"></div>
            <div style="margin-top: 10px; font-size: 0.85rem; color: #888;">ç‡Ÿæ¥­æ™‚æ®µï¼š11:30-14:30 / 17:30-20:30<br>(é€±æ—¥å…¬ä¼‘)</div>
        </div>
    </section>

    <section id="page-menu" class="page-section" style="padding-top: 60px;">
        <div class="category-scroll" id="category-bar"></div>
        <div class="sauce-scroll" id="sauce-bar"></div>
        <div id="menu-container" class="menu-grid"></div>
        
        <div id="view-only-msg" style="text-align:center; padding:20px; color:#999; display:none;">è«‹æƒææ¡Œä¸Š QR Code å³å¯é€²è¡Œé»é¤</div>
    </section>

    <section id="page-info" class="page-section">
        <div class="info-card">
            <h2 style="text-align: center; color: var(--primary-color); margin-bottom: 20px;">Ducale æœå¡å‹’</h2>
            <div class="info-row"><span class="info-icon">ğŸ“</span><div><strong>åœ°å€</strong><br>å°å—å¸‚æ±å€æ¦®è­½è¡—121-6è™Ÿ</div></div>
            <div class="info-row"><span class="info-icon">ğŸ“</span><div><strong>é›»è©±</strong><br><a href="tel:062686550" style="color: var(--primary-color); text-decoration: none;">06-268-6550</a></div></div>
            <hr style="margin: 15px 0; border:0; border-top:1px solid #eee;">
            <p>â° <strong>ç‡Ÿæ¥­æ™‚é–“</strong></p>
            <p>11:30 - 14:30 / 17:30 - 20:30</p>
            <p style="color:#e74c3c;">(é€±æ—¥å…¬ä¼‘)</p>
            
            <iframe 
                width="100%" 
                height="300" 
                style="border:0; border-radius:10px; margin-top:15px;" 
                loading="lazy" 
                allowfullscreen
                referrerpolicy="no-referrer-when-downgrade"
                src="https://maps.google.com/maps?q=Ducale%20%E6%9D%9C%E5%8D%A1%E5%8B%92%20%E5%8F%B0%E5%8D%97%E5%B8%82%E6%9D%B1%E5%8D%80%E6%A6%AE%E8%AD%BD%E8%A1%97121%E8%99%9F&t=&z=15&ie=UTF8&iwloc=&output=embed">
            </iframe>
            
            <div style="text-align:center; margin-top:10px;">
                <a href="https://maps.app.goo.gl/uX3QxQxQxQxQxQxQ" target="_blank" style="color:#666; font-size:0.9rem;">é–‹å•Ÿ Google Maps å°èˆª</a>
            </div>
        </div>
    </section>

    <section id="page-gallery" class="page-section">
        <div id="gallery-container" class="gallery-grid"></div>
    </section>

    <div id="option-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title" style="text-align: center; margin-bottom: 15px;">èœå</h3>
            
            <div id="carb-options-container" style="margin-bottom: 15px;">
                <label style="font-weight: bold;">é¸æ“‡ä¸»é£Ÿ</label>
                <div class="radio-group" id="carb-group"></div>
            </div>

            <div id="extra-options-container">
                <label style="font-weight: bold;">å®¢è£½åŒ–åŠ é‡</label>
                <div class="radio-group" id="extra-options-group"></div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="closeModal()" style="flex:1; padding: 12px; border:none; background:#ccc; border-radius:8px; cursor:pointer;">å–æ¶ˆ</button>
                <button onclick="confirmAddToCart()" style="flex:1; padding: 12px; border:none; background:var(--primary-color); color:white; border-radius:8px; cursor:pointer;">åŠ å…¥</button>
            </div>
        </div>
    </div>

    <div id="success-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: center;">
            <span class="success-icon">âœ”</span>
            <h2>è¨‚å–®å·²é€å‡ºï¼</h2>
            <h3 id="success-table" style="color: var(--primary-color); margin: 10px 0;">æ¡Œè™Ÿï¼š1</h3>
            <div class="order-summary" id="success-summary"></div>
            <h3 style="margin-bottom: 20px;">ç¸½é‡‘é¡ï¼š$<span id="success-total">0</span></h3>
            <p class="success-text">è«‹è‡³æ«ƒæª¯å‡ºç¤ºæ­¤ç•«é¢çµå¸³</p>
            <button onclick="closeSuccessModal()" style="width: 100%; padding: 15px; background: #333; color: white; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer;">é—œé–‰</button>
        </div>
    </div>

    <div id="img-modal" class="modal-overlay" onclick="closeImgModal()">
        <div class="modal-content img-modal-content" onclick="event.stopPropagation()">
            <button class="img-modal-close" onclick="closeImgModal()">âœ•</button>
            <img id="img-display" class="img-display" src="" alt="å•†å“ç…§ç‰‡">
            <div id="img-caption" style="padding: 15px; text-align: center; font-weight: bold;"></div>
        </div>
    </div>

    <div id="cart-drawer" class="cart-drawer"></div>
    <div id="cart-bar" class="cart-bar">
        <div onclick="toggleCart()" style="cursor: pointer;">
            <span>å·²é» <span id="total-count" style="font-weight:bold; color: #f1c40f;">0</span> ä»½ï½œ</span>
            <span style="font-size: 1.2rem; font-weight: bold;">$ <span id="total-amount">0</span></span>
        </div>
        <button onclick="submitOrder()" style="background: #f1c40f; color: #333; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer;">é€å‡ºè¨‚å–®</button>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let currentTable = urlParams.get('table');
        const isViewOnly = !currentTable;

        if (isViewOnly) {
            document.getElementById('table-display').innerText = "ç´”ç€è¦½æ¨¡å¼";
            document.getElementById('table-display').classList.remove('active');
            document.getElementById('home-table-info').innerText = "æœªæƒææ¡Œè™Ÿï¼Œåƒ…ä¾›ç€è¦½èœå–®";
            document.getElementById('home-cta-btn').innerText = "æŸ¥çœ‹èœå–®";
            document.getElementById('view-only-msg').style.display = "block";
        } else {
            document.getElementById('table-display').innerText = `æ¡Œè™Ÿ ${currentTable}`;
            document.getElementById('table-display').classList.add('active');
            document.getElementById('home-table-info').innerText = `æ‚¨ç›®å‰çš„åº§ä½æ˜¯ï¼š${currentTable} è™Ÿæ¡Œ`;
            document.getElementById('home-cta-btn').innerText = "é–‹å§‹é»é¤";
            document.getElementById('view-only-msg').style.display = "none";
        }

        const menuData = {
            "ç¾©å¤§åˆ©éºµ": [
                { name: "å¥¶æ²¹è˜‘è‡", price: 90 }, { name: "åŸ¹æ ¹è˜‘è‡", price: 100 },
                { name: "å¥¶æ²¹é®®è”¬", price: 110 }, { name: "å¥¶æ²¹å«©é›è‚‰", price: 110 },
                { name: "å¥¶æ²¹è›¤èœŠ", price: 110 }, { name: "å¥¶æ²¹è¦ä»", price: 130 },
                { name: "å¥¶æ²¹è˜†ç­è¦ä»", price: 140 }, { name: "å¥¶æ²¹æµ·é®®", price: 150 },
                { name: "ç•ªèŒ„é†¬æ±", price: 90 }, { name: "ç•ªèŒ„è‚‰é†¬", price: 110 },
                { name: "ç•ªèŒ„é®®è”¬", price: 110 }, { name: "ç•ªèŒ„å«©é›è‚‰", price: 110 },
                { name: "ç•ªèŒ„è›¤èœŠ", price: 110 }, { name: "ç•ªèŒ„è¦ä»", price: 130 },
                { name: "ç•ªèŒ„æµ·é®®", price: 150 },
                { name: "ç¾…å‹’é’", price: 90 }, 
                { name: "ç¾…å‹’é®®è”¬", price: 110 }, { name: "ç¾…å‹’å«©é›è‚‰", price: 110 },
                { name: "ç¾…å‹’è›¤èœŠ", price: 110 }, { name: "ç¾…å‹’è™±ç›®é­š", price: 110 },
                { name: "ç¾…å‹’è¦ä»", price: 130 }, { name: "ç¾…å‹’æµ·é®®", price: 150 },
                { name: "å—ç“œé†¬æ±", price: 90 }, 
                { name: "å—ç“œé®®è”¬", price: 110 }, { name: "å—ç“œå«©é›è‚‰", price: 110 },
                { name: "å—ç“œè›¤èœŠ", price: 110 }, { name: "å—ç“œè¦ä»", price: 130 },
                { name: "å—ç“œè˜†ç­è¦ä»", price: 140 }, { name: "å—ç“œæµ·é®®", price: 150 },
            ],
            "ç‡‰é£¯ç³»åˆ—": [
                { name: "å¥¶æ²¹è˜‘è‡", price: 90 }, { name: "åŸ¹æ ¹è˜‘è‡", price: 100 },
                { name: "å¥¶æ²¹é®®è”¬", price: 110 }, { name: "å¥¶æ²¹å«©é›è‚‰", price: 110 },
                { name: "å¥¶æ²¹è›¤èœŠ", price: 110 }, { name: "å¥¶æ²¹è¦ä»", price: 130 },
                { name: "å¥¶æ²¹è˜†ç­è¦ä»", price: 140 }, { name: "å¥¶æ²¹æµ·é®®", price: 150 },
                { name: "ç•ªèŒ„é†¬æ±", price: 90 }, { name: "ç•ªèŒ„è‚‰é†¬", price: 110 },
                { name: "ç•ªèŒ„é®®è”¬", price: 110 }, { name: "ç•ªèŒ„å«©é›è‚‰", price: 110 },
                { name: "ç•ªèŒ„è›¤èœŠ", price: 110 }, { name: "ç•ªèŒ„è¦ä»", price: 130 },
                { name: "ç•ªèŒ„æµ·é®®", price: 150 },
                { name: "ç¾…å‹’é’", price: 90 }, 
                { name: "ç¾…å‹’é®®è”¬", price: 110 }, { name: "ç¾…å‹’å«©é›è‚‰", price: 110 },
                { name: "ç¾…å‹’è›¤èœŠ", price: 110 }, { name: "ç¾…å‹’è™±ç›®é­š", price: 110 },
                { name: "ç¾…å‹’è¦ä»", price: 130 }, { name: "ç¾…å‹’æµ·é®®", price: 150 },
                { name: "å—ç“œé†¬æ±", price: 90 }, 
                { name: "å—ç“œé®®è”¬", price: 110 }, { name: "å—ç“œå«©é›è‚‰", price: 110 },
                { name: "å—ç“œè›¤èœŠ", price: 110 }, { name: "å—ç“œè¦ä»", price: 130 },
                { name: "å—ç“œè˜†ç­è¦ä»", price: 140 }, { name: "å—ç“œæµ·é®®", price: 150 },
            ],
            "é‹ç‡’ç³»åˆ—": [
                { name: "é‹ç‡’æ„éºµ", price: 85 }, { name: "é‹ç‡’é›çµ²", price: 85 }, { name: "é‹ç‡’æ³¡é£¯", price: 85 }, { name: "é‹ç‡’å†¬ç²‰", price: 85 }
            ],
            "ç™½é…’ç³»åˆ—": [
                { name: "ç™½é…’é›è‚‰", price: 140 }, { name: "ç™½é…’è›¤èœŠ", price: 140 }, { name: "ç™½é…’è¦ä»", price: 150 }, { name: "ç™½é…’æµ·é®®", price: 170 }
            ],
            "ç„—çƒ¤ç³»åˆ—": [
                { name: "åŸ¹æ ¹è˜‘è‡", price: 140 },
                { name: "å¥¶æ²¹é®®è”¬", price: 150 }, { name: "å¥¶æ²¹å«©é›è‚‰", price: 150 },
                { name: "å¥¶æ²¹è›¤èœŠ", price: 150 }, { name: "å¥¶æ²¹è¦ä»", price: 170 },
                { name: "å¥¶æ²¹è˜†ç­è¦ä»", price: 180 }, { name: "å¥¶æ²¹æµ·é®®", price: 190 },
                { name: "ç•ªèŒ„è‚‰é†¬", price: 150 },
                { name: "ç•ªèŒ„é®®è”¬", price: 150 }, { name: "ç•ªèŒ„å«©é›è‚‰", price: 150 },
                { name: "ç•ªèŒ„è›¤èœŠ", price: 150 }, { name: "ç•ªèŒ„è¦ä»", price: 170 },
                { name: "ç•ªèŒ„æµ·é®®", price: 190 },
                { name: "ç¾…å‹’é®®è”¬", price: 150 }, { name: "ç¾…å‹’å«©é›è‚‰", price: 150 },
                { name: "ç¾…å‹’è›¤èœŠ", price: 150 }, { name: "ç¾…å‹’è™±ç›®é­š", price: 150 },
                { name: "ç¾…å‹’è¦ä»", price: 170 }, { name: "ç¾…å‹’æµ·é®®", price: 190 },
                { name: "å—ç“œé®®è”¬", price: 150 }, { name: "å—ç“œå«©é›è‚‰", price: 150 },
                { name: "å—ç“œè›¤èœŠ", price: 150 }, { name: "å—ç“œè¦ä»", price: 170 },
                { name: "å—ç“œè˜†ç­è¦ä»", price: 180 }, { name: "å—ç“œæµ·é®®", price: 190 },
                { name: "è˜†ç­åŸ¹æ ¹æ²", price: 160 }
            ],
            "ç”œé»/æ¿ƒæ¹¯": [
                { name: "ç„¦ç³–å¸ƒä¸", price: 45 }, { name: "ä»Šæ—¥æ¿ƒæ¹¯", price: "35" }
            ]
        };

        let cart = [];
        let currentCategory = "ç¾©å¤§åˆ©éºµ";
        let tempSelectedItem = null;
        let currentSauceFilter = null; 

        // é†¬æ±é—œéµå­— (ç¾©å¤§åˆ©éºµ/ç‡‰é£¯/ç„—çƒ¤ å…±ç”¨)
        const sauceRules = {
            "ç™½é†¬": ["å¥¶æ²¹", "ç™½é†¬", "è˜‘è‡"], 
            "ç´…é†¬": ["ç•ªèŒ„", "ç´…é†¬"],
            "é’é†¬": ["é’é†¬", "ç¾…å‹’"],
            "å—ç“œé†¬": ["å—ç“œ"],
            "è˜†ç­åŸ¹æ ¹æ²": ["è˜†ç­åŸ¹æ ¹æ²"]
        };

        function checkBusinessStatus() {
            const now = new Date();
            const day = now.getDay(); 
            const min = now.getHours() * 60 + now.getMinutes();
            const icon = document.getElementById('home-status-icon');
            const text = document.getElementById('home-status-text');

            if (day === 0) {
                icon.innerHTML = "ğŸ’¤ ä»Šæ—¥å…¬ä¼‘"; icon.style.color = "#7f8c8d"; text.innerText = "é€±æ—¥ç‚ºå›ºå®šå…¬ä¼‘æ—¥";
            } else {
                if ((min >= 690 && min < 870) || (min >= 1050 && min < 1230)) {
                    icon.innerHTML = "ğŸ”¥ ç‡Ÿæ¥­ä¸­"; icon.style.color = "#2ecc71";
                    text.innerText = (min < 870) ? "åˆé¤æ™‚æ®µ (11:30 - 14:30)" : "æ™šé¤æ™‚æ®µ (17:30 - 20:30)";
                } else {
                    icon.innerHTML = "â³ ä¼‘æ¯ä¸­"; icon.style.color = "#e67e22";
                    text.innerText = "éç‡Ÿæ¥­æ™‚æ®µï¼Œè«‹åƒè€ƒä¸‹æ–¹ç‡Ÿæ¥­æ™‚é–“";
                }
            }
        }
        checkBusinessStatus();

        function renderCategories() {
            const bar = document.getElementById('category-bar');
            bar.innerHTML = '';
            Object.keys(menuData).forEach(cat => {
                const active = cat === currentCategory ? 'active' : '';
                bar.innerHTML += `<button class="cat-btn ${active}" onclick="changeCategory('${cat}')">${cat}</button>`;
            });
        }

        function changeCategory(cat) { 
            currentCategory = cat; 
            currentSauceFilter = null; 
            renderCategories(); 
            renderSauceBar(); 
            renderMenu(); 
        }

        // --- æ ¸å¿ƒä¿®æ”¹ï¼šåˆ¤æ–·å“ªäº›é¡åˆ¥éœ€è¦é¸é†¬æ± ---
        function renderSauceBar() {
            const sauceBar = document.getElementById('sauce-bar');
            
            // 1. ç¾©å¤§åˆ©éºµ & ç‡‰é£¯ (æ¨™æº– 4 ç¨®)
            if (currentCategory.includes("ç¾©å¤§åˆ©éºµ") || currentCategory.includes("ç‡‰é£¯")) {
                sauceBar.style.display = 'flex';
                sauceBar.innerHTML = '';
                const standardSauces = ["ç™½é†¬", "ç´…é†¬", "é’é†¬", "å—ç“œé†¬"];
                standardSauces.forEach(sauceName => {
                    const active = currentSauceFilter === sauceName ? 'active' : '';
                    sauceBar.innerHTML += `<button class="sauce-btn ${active}" onclick="changeSauce('${sauceName}')">${sauceName}</button>`;
                });
            } 
            // 2. ç„—çƒ¤ç³»åˆ— (æ¨™æº– 4 ç¨® + è˜†ç­åŸ¹æ ¹æ²)
            else if (currentCategory.includes("ç„—çƒ¤")) {
                sauceBar.style.display = 'flex';
                sauceBar.innerHTML = '';
                const gratinSauces = ["ç™½é†¬", "ç´…é†¬", "é’é†¬", "å—ç“œé†¬", "è˜†ç­åŸ¹æ ¹æ²"];
                gratinSauces.forEach(sauceName => {
                    const active = currentSauceFilter === sauceName ? 'active' : '';
                    sauceBar.innerHTML += `<button class="sauce-btn ${active}" onclick="changeSauce('${sauceName}')">${sauceName}</button>`;
                });
            } 
            // 3. å…¶ä»– (éš±è—)
            else {
                sauceBar.style.display = 'none';
                currentSauceFilter = 'ALL'; 
            }
        }

        function changeSauce(sauceName) {
            currentSauceFilter = sauceName;
            renderSauceBar(); 
            renderMenu(); 
        }

        function renderMenu() {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';

            // å¦‚æœæ˜¯ ç¾©å¤§åˆ©éºµ/ç‡‰é£¯/ç„—çƒ¤ï¼Œä¸”é‚„æ²’é¸é†¬æ± -> æç¤ºé¸é†¬
            if ((currentCategory.includes("ç¾©å¤§åˆ©éºµ") || currentCategory.includes("ç‡‰é£¯") || currentCategory.includes("ç„—çƒ¤")) && !currentSauceFilter) {
                container.innerHTML = `<div class="select-sauce-msg">ğŸ‘† è«‹å…ˆé¸æ“‡ä¸Šæ–¹å–œæ­¡çš„é†¬æ±å£å‘³</div>`;
                return;
            }

            const items = menuData[currentCategory];
            let filteredItems = items;

            if (currentSauceFilter && currentSauceFilter !== 'ALL') {
                const keywords = sauceRules[currentSauceFilter];
                filteredItems = items.filter(item => {
                    return keywords.some(k => item.name.includes(k));
                });
            }

            if (filteredItems.length === 0) {
                container.innerHTML = `<div class="select-sauce-msg">æ­¤é†¬æ±ç›®å‰æ²’æœ‰å°æ‡‰é¤é»</div>`;
                return;
            }

            filteredItems.forEach(item => {
                const isNotForSale = typeof item.price !== 'number';
                const canOrder = !isViewOnly && !isNotForSale;
                
                const action = canOrder ? `onclick="openModal('${item.name}', ${item.price}, '${currentCategory}')"` : '';
                const price = isNotForSale ? item.price : `$${item.price}`;
                const itemClass = isViewOnly ? 'menu-item disabled' : 'menu-item';
                
                container.innerHTML += `
                    <div class="${itemClass}" ${action}>
                        <div>
                            <div style="font-weight:bold;">${item.name}</div>
                            <div class="item-price">${price}</div>
                        </div>
                        ${canOrder ? '<span style="color:var(--primary-color); font-size:1.2rem;">+</span>' : ''}
                    </div>`;
            });
        }

        function renderGallery() {
            const container = document.getElementById('gallery-container');
            container.innerHTML = '';
            const defaultImg = 'images/home.jpg';
            Object.keys(menuData).forEach(cat => {
                menuData[cat].forEach(item => {
                    const imgSrc = item.image || defaultImg;
                    container.innerHTML += `<div class="gallery-item" onclick="openImgModal('${item.name}', '${imgSrc}')"><div class="gallery-thumb" style="background-image: url('${imgSrc}');"></div><div class="gallery-name">${item.name}</div></div>`;
                });
            });
        }

        function genRadio(val, label, checked=false, name="extra") { 
            const id = name + '-' + val.replace(/\s/g, ''); 
            return `<input type="radio" name="${name}" id="${id}" value="${val}" ${checked?'checked':''}> 
                    <label for="${id}" class="radio-btn-label">${label}</label>`; 
        }

        function openModal(name, price, category) {
            if (isViewOnly) return;
            tempSelectedItem = { name, price, category };
            document.getElementById('modal-title').innerText = name;

            // ä¸»é£Ÿé¸æ“‡å€ (éºµ/é£¯/é¦¬éˆ´è–¯)
            const carbDiv = document.getElementById('carb-options-container');
            const carbGroup = document.getElementById('carb-group');
            carbDiv.style.display = 'block';

            if (category.includes("ç„—çƒ¤")) {
                if (name === "è˜†ç­åŸ¹æ ¹æ²") {
                    // ç‰¹æ®Šå“é …ï¼šåªèƒ½é¸é£¯
                    carbGroup.innerHTML = genRadio('é£¯', 'é£¯', true, 'carbType');
                } else {
                    // ä¸€èˆ¬ç„—çƒ¤ï¼šç´°éºµ/ç­†å°–/é¦¬éˆ´è–¯
                    carbGroup.innerHTML = 
                        genRadio('S (ç´°é•·éºµ)', 'S ç´°é•·éºµ', true, 'carbType') +
                        genRadio('P (ç­†å°–éºµ)', 'P ç­†å°–éºµ', false, 'carbType') +
                        genRadio('é¦¬éˆ´è–¯', 'é¦¬éˆ´è–¯', false, 'carbType');
                }
            } else if (name.includes("é£¯") || category.includes("ç‡‰é£¯") || category.includes("é‹ç‡’") || category.includes("ç”œé»")) {
                carbDiv.style.display = 'none';
            } else {
                // ç¾©å¤§åˆ©éºµï¼šç´°éºµ/ç­†å°–
                carbGroup.innerHTML = 
                    genRadio('S (ç´°é•·éºµ)', 'S ç´°é•·éºµ', true, 'carbType') +
                    genRadio('P (ç­†å°–éºµ)', 'P ç­†å°–éºµ', false, 'carbType');
                
                if (category.includes("ç™½é…’")) {
                    const pRadio = document.querySelector(`input[name="carbType"][value="P (ç­†å°–éºµ)"]`);
                    if(pRadio) pRadio.disabled = true;
                }
            }

            // åŠ é‡å€
            const extraDiv = document.getElementById('extra-options-container');
            const extraGroup = document.getElementById('extra-options-group');
            let html = '';
            
            if (category.includes("é‹ç‡’")) {
                extraDiv.style.display = 'block'; 
                html = genRadio('0','æ­£å¸¸',true) + genRadio('5','åŠ 1/2 (+$5)') + genRadio('10','åŠ 2/2 (+$10)');
            } else if (category.includes("ç¾©å¤§åˆ©éºµ") || category.includes("ç‡‰é£¯") || category.includes("ç„—çƒ¤") || category.includes("ç™½é…’")) {
                extraDiv.style.display = 'block'; 
                html = genRadio('0','æ­£å¸¸',true) + genRadio('10','åŠ 1/3 (+$10)') + genRadio('20','åŠ 2/3 (+$20)');
            } else { 
                extraDiv.style.display = 'none'; 
            }
            extraGroup.innerHTML = html;

            document.getElementById('option-modal').classList.add('open');
        }

        function closeModal() { document.getElementById('option-modal').classList.remove('open'); }

        function confirmAddToCart() {
            if (!tempSelectedItem) return;
            let noteParts = [];
            let addPrice = 0;

            const carbDiv = document.getElementById('carb-options-container');
            if (carbDiv.style.display !== 'none') {
                const selectedCarb = document.querySelector('input[name="carbType"]:checked');
                if (selectedCarb) {
                    let carbText = selectedCarb.value;
                    if (carbText.includes("ç´°é•·éºµ")) carbText = "(ç´°éºµ)";
                    else if (carbText.includes("ç­†å°–éºµ")) carbText = "(ç­†å°–)";
                    else carbText = `(${carbText})`;
                    noteParts.push(carbText);
                }
            }

            const extraDiv = document.getElementById('extra-options-container');
            if (extraDiv.style.display !== 'none') {
                const sel = document.querySelector('input[name="extra"]:checked');
                if (sel && sel.value > 0) { 
                    addPrice = parseInt(sel.value); 
                    noteParts.push(`åŠ é‡(+$${addPrice})`); 
                }
            }
            
            // æŠŠé¸æ“‡çš„é†¬æ±è¨˜éŒ„ä¸‹ä¾† (å¦‚æœæ˜¯é€™ä¸‰å¤§é¡)
            if (currentSauceFilter && currentSauceFilter !== 'ALL') {
                noteParts.push(currentSauceFilter);
            }

            let finalNote = noteParts.join(" / ");

            cart.push({ name: tempSelectedItem.name, finalPrice: tempSelectedItem.price + addPrice, note: finalNote });
            updateCartUI(); 
            closeModal();
        }

        function openImgModal(name, src) { document.getElementById('img-display').src = src; document.getElementById('img-caption').innerText = name; document.getElementById('img-modal').classList.add('open'); }
        function closeImgModal() { document.getElementById('img-modal').classList.remove('open'); }

        function updateCartUI() {
            let total = 0;
            const drawer = document.getElementById('cart-drawer');
            drawer.innerHTML = '';
            cart.forEach((item, idx) => {
                total += item.finalPrice;
                drawer.innerHTML += `<div class="cart-list-item"><div><b>${item.name}</b> <small style="color:#666;">${item.note}</small></div><div><b>$${item.finalPrice}</b> <button onclick="cart.splice(${idx},1);updateCartUI()" style="margin-left:5px;background:#e74c3c;color:white;border:none;border-radius:50%;width:20px;height:20px;">âœ•</button></div></div>`;
            });
            document.getElementById('total-count').innerText = cart.length;
            document.getElementById('total-amount').innerText = total;
            const bar = document.getElementById('cart-bar');
            if (cart.length > 0 && document.getElementById('page-menu').classList.contains('active') && !isViewOnly) bar.classList.add('active');
            else { bar.classList.remove('active'); toggleCart(false); }
        }
        function toggleCart(force) { const d = document.getElementById('cart-drawer'); const open = force !== undefined ? force : !d.classList.contains('open'); open ? d.classList.add('open') : d.classList.remove('open'); }
        
        function submitOrder() {
            if (cart.length === 0) return alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„");

            const btn = document.querySelector('#cart-bar button');
            const originalText = btn.innerText;
            btn.innerText = "å‚³é€ä¸­...";
            btn.disabled = true;

            let total = 0;
            let summaryHtml = "";
            cart.forEach(item => {
                total += item.finalPrice;
                summaryHtml += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:5px 0;"><span>${item.name} <small>${item.note}</small></span><span>$${item.finalPrice}</span></div>`;
            });

            const orderData = {
                table: currentTable,
                total: total,
                cart: cart
            };

            const scriptURL = 'https://script.google.com/macros/s/AKfycbzolDHjA5ymcsXOHwIq_0N6vE8awlVh9nmmeoI2z7nfhKAh0X3ZAHLxi4uxzLd6fmXUhA/exec'; 

            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(orderData)
            })
            .then(response => {
                document.getElementById('success-table').innerText = currentTable === "å¤–å¸¶" ? "å¤–å¸¶å–®" : `æ¡Œè™Ÿï¼š${currentTable}`;
                document.getElementById('success-summary').innerHTML = summaryHtml;
                document.getElementById('success-total').innerText = total;

                toggleCart(false); 
                document.getElementById('cart-bar').classList.remove('active');
                document.getElementById('success-modal').classList.add('open');
                
                btn.innerText = originalText;
                btn.disabled = false;
            })
            .catch(error => {
                console.error('Error!', error.message);
                alert("å‚³é€å¤±æ•—ï¼Œè«‹è«‹å«æœå‹™äººå“¡å”åŠ©ï¼");
                btn.innerText = originalText;
                btn.disabled = false;
            });
        }
        function closeSuccessModal() { cart = []; updateCartUI(); document.getElementById('success-modal').classList.remove('open'); switchPage('home'); }

        function switchPage(pageId) {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebar-overlay').classList.remove('active');
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            const bar = document.getElementById('cart-bar');
            if (pageId === 'menu' && cart.length > 0 && !isViewOnly) bar.classList.add('active'); else bar.classList.remove('active');
            if (pageId === 'menu') { renderCategories(); renderSauceBar(); renderMenu(); }
            if (pageId === 'gallery') { renderGallery(); }
            window.scrollTo(0, 0);
        }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('sidebar-overlay').classList.toggle('active'); }
    </script>
</body>
</html>